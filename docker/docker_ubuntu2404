FROM ubuntu:24.04

ARG DEBIAN_FRONTEND=noninteractive

RUN apt-get update \
    && apt install -y \
      wget \
      curl \
      git \
      ca-certificates \
      pkg-config \
      opencl-headers \
      libvulkan-dev \
      libx11-dev \
      build-essential \
      libavcodec60 \
      libavcodec-dev \
      libavutil58 \
      libavutil-dev \
      libavformat60 \
      libavformat-dev \
      libswresample4 \
      libswresample-dev \
      libavfilter9 \
      libavfilter-dev \
      libavdevice60 \
      libavdevice-dev \
      libass9 \
      libass-dev \
      openssl \
      libssl-dev \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

ENV RUSTUP_HOME=/usr/local/rustup
ENV CARGO_HOME=/usr/local/cargo
ENV PATH=/usr/local/cargo/bin:$PATH

RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs \
      | sh -s -- -y --profile minimal \
    && /usr/local/cargo/bin/rustup show \
    && /usr/local/cargo/bin/cargo --version \
    && /usr/local/cargo/bin/cargo install cargo-c --locked \
    && /usr/local/cargo/bin/cargo cbuild --version

WORKDIR /work
